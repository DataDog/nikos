---
- name: Prepare
  hosts: all
  tasks:
    - name: Switch to archive
      shell: |
        echo "deb http://archive.debian.org/ jessie/updates main contrib non-free" | sudo tee /etc/apt/sources.list
        echo "deb http://archive.debian.org/debian/ jessie main" | sudo tee -a /etc/apt/sources.list
        echo "deb http://archive.debian.org/debian/ jessie-backports main" | sudo tee -a /etc/apt/sources.list
        echo "deb-src http://archive.debian.org/debian/ jessie-backports main" | sudo tee -a /etc/apt/sources.list
        echo "Acquire::Check-Valid-Until false;" | sudo tee -a /etc/apt/apt.conf.d/nikos-nocheckvalid
        echo "APT::Get::AllowUnauthenticated true;" | sudo tee -a /etc/apt/apt.conf.d/nikos-allow-unauthenticated
        echo 'Package: *\nPin: origin "archive.debian.org"\nPin-Priority: 500' | sudo tee -a /etc/apt/preferences.d/10-archive-pin
        sudo apt-get update -y
      become: true
      when: ansible_distribution_release == 'jessie'

    - name: Force apt update
      shell: "apt-get update -y"
      become: true
      when: ansible_distribution_release == 'jessie'
