---
- name: Converge
  hosts: all
  become: true
  vars:
    test_type: "{{ lookup('env', 'TEST_TYPE') }}"
  tasks:
  - synchronize:
      src: /opt/nikos
      dest: /opt
      archive: yes
    become: true

  - name: Create a directory if it does not exist
    file:
      path: /tmp/result
      state: directory
      mode: 0755
    become: true
    when: test_type == 'container'

  - name: Create a debian container
    community.general.docker_container:
      name: debian
      image: debian
      volumes:
        - /etc/os-release:/etc/os-release:ro
        - /etc/redhat-release:/etc/redhat-release:ro
        - /etc/apt:/etc/apt:ro
        - /etc/zypp/repos.d:/etc/zypp/repos.d:ro
        - /etc/pki:/etc/pki:ro
        - /opt/nikos:/opt/nikos:ro
        - /tmp/result:/tmp/result
      command: sleep 3600
    become: true
    when: test_type == 'container'
